<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest Fire Detection System - 3D Simulation</title>
    <meta name="description" content="Interactive 3D simulation of a forest fire detection system using IoT sensors and Three.js">
    <meta name="keywords" content="forest fire detection, IoT, Three.js, simulation, STM32, XBEE">
    <meta name="author" content="Your Name">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¥</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap');

        body {
            margin: 0;
            background: linear-gradient(135deg, #050505 0%, #0a0a0a 50%, #050505 100%);
            font-family: 'Rajdhani', sans-serif;
            color: white;
            line-height: 1.6;
        }

        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(5, 5, 5, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 1rem 0;
            border-bottom: 1px solid #00ff9d;
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #00ff9d;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #00ff9d;
        }

        main {
            margin-top: 80px;
        }

        section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
        }

        #hero {
            position: relative;
            background: radial-gradient(circle at center, rgba(0, 255, 157, 0.1) 0%, transparent 70%);
        }

        #canvas-container {
            width: 100%;
            max-width: 1200px;
            height: 60vh;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 255, 157, 0.3);
            display: block;
        }

        #about, #components {
            background: rgba(5, 5, 5, 0.5);
            backdrop-filter: blur(5px);
        }

        .section-content {
            max-width: 1200px;
            text-align: center;
        }

        #about h2, #components h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            margin-bottom: 2rem;
            background: linear-gradient(90deg, #00ff9d, #00b8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #about p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 2rem;
            color: #ccc;
        }

        footer {
            background: rgba(5, 5, 5, 0.9);
            padding: 2rem;
            text-align: center;
            border-top: 1px solid #333;
        }

        footer p {
            margin: 0;
            color: #888;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #333;
            border-top: 3px solid #00ff9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #00ff9d;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            #canvas-container {
                height: 50vh;
            }

            #about h2, #components h2 {
                font-size: 2rem;
            }

            .ui-panel {
                padding: 10px;
            }

            .status-panel {
                width: 200px;
                right: 10px;
                top: 10px;
            }

            .controls {
                flex-direction: column;
                gap: 10px;
            }

            button {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }

        /* UI Overlays */
        .ui-panel {
            position: absolute;
            pointer-events: none; /* Let clicks pass through to 3D */
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            text-align: center;
            text-shadow: 0 0 10px #00ff9d;
            pointer-events: auto;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(90deg, #00ff9d, #00b8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            pointer-events: auto;
            margin-bottom: 20px;
        }

        button {
            background: rgba(0, 20, 10, 0.8);
            border: 1px solid #00ff9d;
            color: #00ff9d;
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            backdrop-filter: blur(5px);
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }

        button:hover {
            background: #00ff9d;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
        }

        button:active {
            transform: scale(0.95);
        }

        /* Status Indicators */
        .status-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            padding: 20px;
            width: 250px;
            pointer-events: auto;
            border-left: 3px solid #00ff9d;
        }

        .status-item {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .status-label { color: #888; }
        .status-value { font-weight: bold; color: #00ff9d; }
        .status-value.alert { color: #ff3333; animation: blink 0.5s infinite; }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* Component Slides Overlay */
        #slides-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(20px);
            z-index: 100;
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        .slide-content {
            width: 80%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            animation: fadeIn 0.5s ease;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .slide-text h2 {
            font-family: 'Orbitron';
            color: #00ff9d;
            border-bottom: 2px solid #00ff9d;
            padding-bottom: 10px;
        }

        .component-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .component-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .component-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .component-item i { color: #ff6b00; }

        .close-btn {
            position: absolute;
            top: 90px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Labels in 3D space */
        .label {
            position: absolute;
            color: white;
            font-family: 'Rajdhani', sans-serif;
            background: rgba(0,0,0,0.6);
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            user-select: none;
            border: 1px solid #444;
        }
    </style>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls (Usually separate, including a minified version for single-file) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- TWEEN for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Simulation...</div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <nav>
            <a href="#hero" class="logo">Forest Fire Detection</a>
            <div class="nav-links">
                <a href="#hero">Simulation</a>
                <a href="#about">About</a>
                <a href="#components">Components</a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section with Simulation -->
        <section id="hero">
            <div class="section-content">
                <h1>Interactive 3D Forest Fire Detection Simulation</h1>
                <p>Experience real-time IoT sensor monitoring and wireless communication in action</p>
                <div id="canvas-container"></div>

                <!-- UI Overlay for Simulation -->
                <div class="ui-panel">
                    <div class="header">
                        <h1>FOREST FIRE SIMULATION</h1>
                        <p>STM32 â€¢ XBEE â€¢ SENSORS â€¢ IOT</p>
                    </div>

                    <div class="status-panel">
                        <h3>SYSTEM STATUS</h3>
                        <div class="status-item">
                            <span class="status-label">Signal:</span>
                            <span class="status-value" id="status-signal">Idle</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Temperature:</span>
                            <span class="status-value" id="status-temp">24Â°C</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Smoke Lvl:</span>
                            <span class="status-value" id="status-smoke">Normal</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Alert:</span>
                            <span class="status-value" id="status-alert">NONE</span>
                        </div>
                    </div>

                    <div class="controls">
                        <button onclick="toggleSlides()">Components</button>
                        <button onclick="startSimulation()" style="border-color: #ff6b00; color: #ff6b00;">TRIGGER FIRE</button>
                        <button onclick="resetSimulation()">RESET</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about">
            <div class="section-content">
                <h2>About the Project</h2>
                <p>This interactive 3D simulation demonstrates a comprehensive forest fire detection system using IoT technologies. The system consists of two main nodes: a Forest Node equipped with environmental sensors and a Headquarters Node for monitoring and alerting.</p>
                <p>The simulation showcases real-time data transmission via XBee wireless modules, sensor readings, and automated alert mechanisms that activate when fire conditions are detected.</p>
                <div style="margin-top: 2rem; padding: 1rem; background: rgba(0, 255, 157, 0.1); border-left: 4px solid #00ff9d;">
                    <strong>Key Features:</strong>
                    <ul style="color: #ccc; margin-top: 0.5rem;">
                        <li>Real-time 3D visualization of IoT components</li>
                        <li>Wireless communication simulation</li>
                        <li>Environmental sensor monitoring</li>
                        <li>Automated alert system</li>
                        <li>Interactive controls and status monitoring</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Components Section -->
        <section id="components">
            <div class="section-content">
                <h2>Hardware Components</h2>
                <p>The core components required to build the Forest Fire Detection Node and Headquarters Receiver.</p>
                <div style="margin-top: 2rem; border-left: 3px solid #ff6b00; padding-left: 15px; color: #aaa;">
                    "Reliable detection starts with robust hardware."
                </div>
                <div class="component-list">
                    <div class="component-item"><i class="fa-solid fa-microchip"></i> <span>STM32F303RET6 Nucleo (x2)</span></div>
                    <div class="component-item"><i class="fa-solid fa-wifi"></i> <span>XBee Modules (x2)</span></div>
                    <div class="component-item"><i class="fa-solid fa-fire"></i> <span>MQ-2 Gas Sensor</span></div>
                    <div class="component-item"><i class="fa-solid fa-temperature-high"></i> <span>DHT-22 Sensor</span></div>
                    <div class="component-item"><i class="fa-solid fa-tv"></i> <span>16x2 LCD Display</span></div>
                    <div class="component-item"><i class="fa-solid fa-volume-high"></i> <span>Active Buzzer</span></div>
                    <div class="component-item"><i class="fa-solid fa-grip-lines"></i> <span>Breadboards</span></div>
                    <div class="component-item"><i class="fa-solid fa-plug"></i> <span>Jumper Wires</span></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Forest Fire Detection System. Built with Three.js and IoT Technologies.</p>
    </footer>

    <!-- Slides Overlay (Modal for Components) -->
    <div id="slides-overlay">
        <button class="close-btn" onclick="toggleSlides()">&times;</button>
        <div class="slide-content">
            <div class="slide-text">
                <h2>HARDWARE INVENTORY</h2>
                <p>The core components required to build the Forest Fire Detection Node and Headquarters Receiver.</p>
                <div style="margin-top: 20px; border-left: 3px solid #ff6b00; padding-left: 15px; color: #aaa;">
                    "Reliable detection starts with robust hardware."
                </div>
            </div>
            <div class="component-list">
                <div class="component-item"><i class="fa-solid fa-microchip"></i> <span>STM32F303RET6 Nucleo (x2)</span></div>
                <div class="component-item"><i class="fa-solid fa-wifi"></i> <span>XBee Modules (x2)</span></div>
                <div class="component-item"><i class="fa-solid fa-fire"></i> <span>MQ-2 Gas Sensor</span></div>
                <div class="component-item"><i class="fa-solid fa-temperature-high"></i> <span>DHT-22 Sensor</span></div>
                <div class="component-item"><i class="fa-solid fa-tv"></i> <span>16x2 LCD Display</span></div>
                <div class="component-item"><i class="fa-solid fa-volume-high"></i> <span>Active Buzzer</span></div>
                <div class="component-item"><i class="fa-solid fa-grip-lines"></i> <span>Breadboards</span></div>
                <div class="component-item"><i class="fa-solid fa-plug"></i> <span>Jumper Wires</span></div>
            </div>
        </div>
    </div>

    <script>
        // --- THREE.JS SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.02); // Distance fog for atmosphere

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 15, 30);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // --- LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0x404040, 2); // Soft white light
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        scene.add(dirLight);

        const pointLight = new THREE.PointLight(0x00ff9d, 0.5);
        pointLight.position.set(-10, 5, 0);
        scene.add(pointLight);

        // --- MATERIALS ---
        const breadboardMat = new THREE.MeshPhongMaterial({ color: 0xdddddd });
        const pcbGreenMat = new THREE.MeshPhongMaterial({ color: 0x004400, shininess: 100 });
        const pcbBlueMat = new THREE.MeshPhongMaterial({ color: 0x003366, shininess: 100 });
        const blackMat = new THREE.MeshPhongMaterial({ color: 0x111111 });
        const silverMat = new THREE.MeshStandardMaterial({ color: 0xaaaaaa, metalness: 0.8, roughness: 0.2 });
        const lcdOffMat = new THREE.MeshPhongMaterial({ color: 0x334433 });
        const whitePlasticMat = new THREE.MeshPhongMaterial({ color: 0xffffff });
        const wireMat = new THREE.MeshBasicMaterial({ color: 0xff0000 }); // Red wires
        
        // --- TEXTURE GENERATION FOR LCD ---
        function createTextTexture(text, color, bgColor) {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, 256, 64);
            ctx.font = 'bold 30px monospace';
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 128, 32);
            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        const lcdSafeTex = createTextTexture("STATUS: SAFE", "#000000", "#99cc00");
        const lcdFireTex = createTextTexture("!! FIRE !!", "#000000", "#ff3300");
        const lcdMat = new THREE.MeshBasicMaterial({ map: lcdSafeTex });

        // --- OBJECT CREATION HELPERS ---

        function createBreadboard(x, z) {
            const board = new THREE.Mesh(new THREE.BoxGeometry(14, 0.5, 6), breadboardMat);
            board.position.set(x, 0, z);
            board.castShadow = true;
            board.receiveShadow = true;
            
            // Add central groove
            const groove = new THREE.Mesh(new THREE.BoxGeometry(14, 0.1, 0.2), blackMat);
            groove.position.y = 0.26;
            board.add(groove);
            
            scene.add(board);
            return board;
        }

        function createSTM32(parent, x, z) {
            const pcb = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 1.5), pcbBlueMat);
            pcb.position.set(x, 0.5, z);
            
            // Chip
            const chip = new THREE.Mesh(new THREE.BoxGeometry(1, 0.1, 1), blackMat);
            chip.position.y = 0.15;
            pcb.add(chip);
            
            // USB Port
            const usb = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.3, 0.5), silverMat);
            usb.position.set(-1.8, 0.1, 0);
            pcb.add(usb);
            
            parent.add(pcb);
            return pcb;
        }

        function createXBee(parent, x, z) {
            const pcb = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.1, 1.5), pcbGreenMat);
            pcb.position.set(x, 0.5, z);
            
            // Antenna
            const ant = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 1), blackMat);
            ant.rotation.x = Math.PI / 2;
            ant.position.set(0.8, 0, 0);
            pcb.add(ant);
            
            parent.add(pcb);
            return pcb;
        }

        function createMQ2(parent, x, z) {
            const base = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 0.5, 32), silverMat);
            base.position.set(x, 0.6, z);
            
            const meshTop = new THREE.Mesh(new THREE.SphereGeometry(0.4, 16, 16, 0, Math.PI * 2, 0, Math.PI/2), blackMat);
            meshTop.position.y = 0.25;
            base.add(meshTop);
            
            parent.add(base);
            return base;
        }

        function createDHT22(parent, x, z) {
            const box = new THREE.Mesh(new THREE.BoxGeometry(1, 1.2, 0.4), whitePlasticMat);
            box.position.set(x, 0.9, z);
            
            // Grille
            const grille = new THREE.Mesh(new THREE.PlaneGeometry(0.8, 0.6), blackMat);
            grille.position.z = 0.21;
            grille.position.y = 0.1;
            box.add(grille);
            
            parent.add(box);
            return box;
        }

        function createLCD(parent, x, z) {
            const board = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 2), pcbGreenMat);
            board.position.set(x, 0.5, z);
            
            const screen = new THREE.Mesh(new THREE.BoxGeometry(3, 0.1, 1), lcdMat);
            screen.position.y = 0.15;
            board.add(screen);
            
            parent.add(board);
            return { mesh: board, screenMat: lcdMat };
        }

        function createBuzzer(parent, x, z) {
            const cyl = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.4, 0.4), blackMat);
            cyl.position.set(x, 0.5, z);
            parent.add(cyl);
            return cyl;
        }

        function createWire(parent, start, end) {
             // Simple bezier curve for wire
             const curve = new THREE.QuadraticBezierCurve3(
                new THREE.Vector3(start.x, 0.5, start.z),
                new THREE.Vector3((start.x+end.x)/2, 2, (start.z+end.z)/2), // High arch
                new THREE.Vector3(end.x, 0.5, end.z)
            );
            const points = curve.getPoints(20);
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const line = new THREE.Line(geometry, wireMat);
            parent.add(line);
        }

        // --- SCENE ASSEMBLY ---

        // 1. Forest Node (Centered Left)
        const forestBoard = createBreadboard(-6, 0);
        const stmForest = createSTM32(forestBoard, -3, 0);
        const xbeeForest = createXBee(forestBoard, 0, -1.5);
        const mq2 = createMQ2(forestBoard, 2, 0);
        const dht22 = createDHT22(forestBoard, 4, 0);

        // Labels Forest
        function addLabel(text, x, y, z) {
            // Using sprites for labels
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.font = "Bold 20px Arial";
            ctx.fillStyle = "rgba(0,0,0,0.5)";
            ctx.fillRect(0,0, 150, 40);
            ctx.fillStyle = "#00ff9d";
            ctx.fillText(text, 10, 25);
            const tex = new THREE.CanvasTexture(canvas);
            const spriteMat = new THREE.SpriteMaterial({ map: tex });
            const sprite = new THREE.Sprite(spriteMat);
            sprite.position.set(x, y, z);
            sprite.scale.set(3, 0.8, 1);
            scene.add(sprite);
        }
        addLabel("FOREST NODE", -6, 4, 0);
        addLabel("HQ NODE", 6, 4, 0);


        // 2. HQ Node (Centered Right)
        const hqBoard = createBreadboard(6, 0);
        const stmHQ = createSTM32(hqBoard, -3, 0);
        const xbeeHQ = createXBee(hqBoard, 0, -1.5);
        const lcdObj = createLCD(hqBoard, 3, 0);
        const buzzer = createBuzzer(hqBoard, 5, -1.5);

        // 3. Wires (Visual only)
        createWire(forestBoard, {x:-3, z:0}, {x:0, z:-1.5}); // STM -> XBee
        createWire(forestBoard, {x:-3, z:0}, {x:2, z:0}); // STM -> MQ2

        createWire(hqBoard, {x:-3, z:0}, {x:0, z:-1.5}); // STM -> XBee
        createWire(hqBoard, {x:-3, z:0}, {x:3, z:0}); // STM -> LCD

        // --- PARTICLE SYSTEM (FIRE/SMOKE) ---
        const particleCount = 200;
        const particlesGeom = new THREE.BufferGeometry();
        const particlePositions = new Float32Array(particleCount * 3);
        const particleVelocities = [];

        for(let i=0; i<particleCount; i++) {
            particlePositions[i*3] = -4 + (Math.random() * 0.5); // x (Near MQ2 position relative to world)
            particlePositions[i*3+1] = 0.5; // y
            particlePositions[i*3+2] = 0 + (Math.random() * 0.5); // z
            particleVelocities.push({x: (Math.random()-0.5)*0.05, y: Math.random()*0.1, z: (Math.random()-0.5)*0.05});
        }
        particlesGeom.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));

        const particleMat = new THREE.PointsMaterial({
            color: 0xff4500,
            size: 0.3,
            transparent: true,
            opacity: 0, // Hidden initially
            blending: THREE.AdditiveBlending
        });

        const fireSystem = new THREE.Points(particlesGeom, particleMat);
        // Correcting position to match world coordinates of MQ2 (-6 + 2 = -4)
        fireSystem.position.set(-4, 0, 0);
        scene.add(fireSystem);


        // --- SIGNAL PACKET (Sphere) ---
        const packet = new THREE.Mesh(new THREE.SphereGeometry(0.3, 16, 16), new THREE.MeshBasicMaterial({color: 0x00ffff}));
        packet.position.set(-6, 1, -1.5); // Start at Forest XBee
        packet.visible = false;
        scene.add(packet);

        // --- ANIMATION LOGIC ---
        let isSimulating = false;
        let fireOpacity = 0;

        function startSimulation() {
            if(isSimulating) return;
            isSimulating = true;
            
            // 1. Start Fire
            new TWEEN.Tween({opacity: 0})
                .to({opacity: 1}, 1000)
                .onUpdate(obj => {
                    particleMat.opacity = obj.opacity;
                    document.getElementById('status-smoke').innerText = "CRITICAL";
                    document.getElementById('status-smoke').style.color = "#ff3333";
                    document.getElementById('status-temp').innerText = "85Â°C";
                    document.getElementById('status-temp').style.color = "#ff3333";
                })
                .start();

            // 2. Transmit Signal (after small delay)
            setTimeout(() => {
                packet.visible = true;
                document.getElementById('status-signal').innerText = "Transmitting...";
                
                // Tween Position from Left XBee (-6) to Right XBee (+6)
                new TWEEN.Tween(packet.position)
                    .to({x: 6}, 1500)
                    .easing(TWEEN.Easing.Quadratic.InOut)
                    .onComplete(() => {
                        packet.visible = false;
                        packet.position.x = -6; // Reset
                        triggerAlert();
                    })
                    .start();
            }, 2000);
        }

        function triggerAlert() {
            document.getElementById('status-signal').innerText = "Received";
            document.getElementById('status-alert').innerText = "BUZZER ON";
            document.getElementById('status-alert').classList.add('alert');
            
            // Update LCD
            lcdMat.map = lcdFireTex;
            
            // Shake Buzzer
            const startY = buzzer.position.y;
            new TWEEN.Tween(buzzer.scale)
                .to({x: 1.5, z: 1.5}, 100)
                .yoyo(true)
                .repeat(10)
                .start();
        }

        function resetSimulation() {
            isSimulating = false;
            
            // Reset UI
            document.getElementById('status-smoke').innerText = "Normal";
            document.getElementById('status-smoke').style.color = "#00ff9d";
            document.getElementById('status-temp').innerText = "24Â°C";
            document.getElementById('status-temp').style.color = "#00ff9d";
            document.getElementById('status-signal').innerText = "Idle";
            document.getElementById('status-alert').innerText = "NONE";
            document.getElementById('status-alert').classList.remove('alert');

            // Reset 3D
            particleMat.opacity = 0;
            packet.visible = false;
            packet.position.x = -8;
            lcdMat.map = lcdSafeTex;
            buzzer.scale.set(1,1,1);
            TWEEN.removeAll();
        }

        function toggleSlides() {
            const overlay = document.getElementById('slides-overlay');
            overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
        }

        // --- RENDER LOOP ---
        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);
            controls.update();

            // Animate Fire Particles
            if(particleMat.opacity > 0) {
                const positions = fireSystem.geometry.attributes.position.array;
                for(let i=0; i<particleCount; i++) {
                    // Move up
                    positions[i*3+1] += particleVelocities[i].y;
                    
                    // Reset if too high
                    if(positions[i*3+1] > 3) {
                        positions[i*3+1] = 0.5;
                    }
                }
                fireSystem.geometry.attributes.position.needsUpdate = true;
            }

            renderer.render(scene, camera);
        }

        animate();

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Hide loading screen after page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 1000); // Delay for better UX
        });

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

    </script>
</body>
</html>
